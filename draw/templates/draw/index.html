{% load static %}
<!-- https://stackoverflow.com/questions/1085801/get-selected-value-in-dropdown-list-using-javascript
<!DOCTYPE html> -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Shared Finances</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet">
    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

    <style type="text/css">
      
      body {
        background-color: #d5fdd5;
      }
      
      .bank {
        height:260px;
        background: transparent;
        text-align: center:
      }
      
      .title {
        font-size: 80px;
        text-align: center;
        margin-top:10px;
        font-family: "Montserrat";
      }
      
      .category {
        font-size:30px;
        text-align: left;
        padding-top: 20px;
        padding-bottom: 20px;
        padding-left:20px;
        font-family: "Roboto";
      }
      
      .flex-container{
        display: flex;
        flex-direction: column;
        flex-wrap: wrap;
        height: 60vh;
        justify-content: flex-start;
        align-items: center;
      }
      
      .box {
        width: 50%;
        height: 25%;
      }
      
      .log-box {
        font-family: "Roboto";
        font-size: 20px;
      }
        
    </style>

</head>
<body>
    
<!--   <img class="bank" src = "http://www.sclance.com/pngs/piggy-bank-png/piggy_bank_png_1023807.jpg"> -->
  
  <div class = "container">
    
    <div class= "row">
      <div class ="col-12 title">
        Shared Finances
      </div>
    </div>
    <hr>
    
    <div class="flex-container">

        <div class="category box">
         <i class="fa fa-cutlery" aria-hidden="true" id="food"></i>
          Food:
        </div>
        <div class="category box">
          <i class="fa fa-bicycle" aria-hidden="true"></i>
          Activities:
        </div>
        <div class="category box">
          <i class="fa fa-subway" aria-hidden="true"></i>
          Transportation:
        </div>
        <div class="category box">
          <form id = "misc">
            <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
          Misc:           
        </div>

        <div id="total-budget" class ="box">
        </div>
      
  </div>
    
   <hr>
     
  <div class="container" id="log" style="padding-top:30px;">
 
  </div>
      
  <div id = "submitForm">
          <form> 
            Category:<br>
            <select name="Category" id="category" size="4">
              <option value="Food">Food</option>
              <option value="Activities">Activities</option>
              <option value="Transportation">Transportation</option>
              <option value="Misc">Misc.</option></select>
            <br>Amount:<br>
            <input type="text" name="amount" id="amount"> <br><br> 
            <div id ="submit" value="Submit"> Submit </div>
          </form>
   </div>
  
</body>
  
  
<script>  
  
   $(document).ready(()=>{
     
     var url = window.location.href;
     
    
     var catgories = ["Food", "Activities", "Transportation", "Misc."];
     // list of users
      // creates a  random user 
     var users = ["Alice","Bob", "Eve", "Jack", "Jill", "Carl", "Josh"];
     var user = users[Math.trunc(Math.random()*users.length)];
                                 
     var url_large = "http://sharedfinances-hchotwani921366.codeanyapp.com/draw/?size=large";
     var socket = new WebSocket('wss://sharedFinances-hchotwani921366.codeanyapp.com/ws/draw');
     
     document.getElementById("submit").onclick = function() {sendInfo()};

    function sendInfo() {
      //amount
      var amt = document.getElementById("amount").value;
      
      //category
      var e = document.getElementById("category");
      var value = e.options[e.selectedIndex].value;
      var text = e.options[e.selectedIndex].text;
      
      console.log(value);
      console.log(amt);
      
      //send Info
      var info = {"user": user, "amount": amt, "category":value};
      var infoJSON = JSON.stringify(info);
      socket.send(infoJSON);
      
      //confirmation of action                 
      alert("you have submitted your purchase!");                 
    };
     
     
     socket.onmessage = function(message) {
       var info = JSON.parse(message.data);
       if (url===url_large) {
         $("#log").append("<div class='row log-box'><div class='col-12'>" + info.user + " spent $" + info.amount + " on "+ info.category + "</div></div>");
         console.log(info.amount);
         console.log(info.category);
       } else {
         console.log("did not do anything with the message!!");
       }
     }
     
     if (url === url_large) {
         // document.getElementById("submitForm").style.display = "none";
         $("#submitForm").hide(0.000001);
     }
  
  
   })
  
</script>
</html>