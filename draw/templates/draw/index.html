{% load static %}
<!-- https://stackoverflow.com/questions/1085801/get-selected-value-in-dropdown-list-using-javascript
<!DOCTYPE html> -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Shared Finances</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet">
    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

    <style type="text/css">
      
      body {
        background-color: #d5fdd5;
      }
      
      .bank {
        height:260px;
        background: transparent;
        text-align: center:
      }
      
      .title {
        font-size: 80px;
        text-align: center;
        font-family: "Montserrat";
        margin-top:-20px;
        color:black;
        
      }
      
      .category {
        font-size:30px;
        text-align: left;
        padding-top: 20px;
        padding-bottom: 20px;
        padding-left:20px;
        font-family: "Roboto";
      }
      
      .flex-container{
        display: flex;
        flex-direction: column;
        flex-wrap: wrap;
        height: 60vh;
        justify-content: flex-start;
        align-items: center;
      }
      
      .box {
        width: 70%;
        height: 25%;
      }
      
      .log-box {
        font-family: "Roboto";
        font-size: 20px;
      }
      
      .btn {
        background-color: white; 
        margin-top: 20px;
      }
      
          .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%; 
      overflow: auto; 
      background-color: rgb(0,0,0); 
      background-color: rgba(0,0,0,0.4); 
    }
    /* Modal Content/Box */
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto; 
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      font-size:60px;
      font-family: "Montserrat";
      
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 78px;
      font-weight: bold;
    }
    .instBox {
        text-align: left;
        size: 15px;
        color: black;
        font-family: "Roboto";
    }
      
      .formy {
        font-size: 30px;
      }
        
    </style>

</head>
<body>
    
<!--   <img class="bank" src = "http://www.sclance.com/pngs/piggy-bank-png/piggy_bank_png_1023807.jpg"> -->
  
  <div class = "container">
    
    <div class="row" style="margin-top:30px;" >
      <div class="col-2">
        <button class="btn plan" id = "sharedBtn"><i class="fa fa-plus" ></i> Plan Budget</button>
      </div>
      
      <div class ="col-8 title">
        Shared Finances
      </div>
      
      <div class="col-2" id="userBtn" style="margin-top:-30px;">
        <button class = "btn" style="text-align:right;"><i class="fa fa-user" ></i> Add User</button>
        <button class = "btn" style="text-align:right;"><i class="fa fa-info" ></i> Instructions</button>
        
<!--                       <div id="myInstModal" class="modal">
                                  <div class="modal-content">
                                    <span class="close" id="close1">&times;</span>
                                      <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-12 instBox" style="margin-bottom:20px;">
                                                Instructions
                                            </div>
                                            
                                        </div>
                                        <div class="row">
                                            <div class="col-12" style="text-align: left; font-size:35px;">
                                                Blah Blah Blah
                                            </div>
                                        </div>
                                      </div>
                                  </div>
                            </div> -->
      </div>
      
    </div>
   

    <hr>
    
    <div class="flex-container">

        <div class="category box food-div">
         <i class="fa fa-cutlery" aria-hidden="true"></i>
          Food: $
          <input class = "input-for-amounts" type="text" name="food-amount" id="food-amount">
        </div>
        <div class="category box act-div">
          <i class="fa fa-bicycle" aria-hidden="true"></i>
          Activities: $
          <input class = "input-for-amounts" type="text" name="act-amount" id="act-amount">
        </div>
        <div class="category box tra-div">
          <i class="fa fa-subway" aria-hidden="true"></i>
          Transportation: $
          <input class = "input-for-amounts" type="text" name="tra-amount" id="tra-amount">
        </div>
        <div class="category box misc-div">
          <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
          Misc: $
          <input class = "input-for-amounts" type="text" name="misc-amount" id="misc-amount">
        </div>
      

        <div id="total-budget" class ="box">
        </div>
      
  </div>
   <div class="row" style="margin-top:30px;">
      <div class="col-12" style="text-align:right;">
        <button class="btn finalize-btn"><i class="fa fa-check" ></i> Finalize Budget</button>
      </div>
    </div>
   <hr>
     
  <div class="container" id="log" style="padding-top:30px;">
 
  </div>
      
  <div id = "submitForm">
          <form> 
            Category:<br>
            <select class = "formy" name="Category" id="category" size="4">
              <option value="Food">Food</option>
              <option value="Activities">Activities</option>
              <option value="Transportation">Transportation</option>
              <option value="Misc">Misc.</option></select>
            <br>Amount:<br>
            <input type="text" name="amount" id="amount"> <br><br> 
            <div id ="submit" value="Submit"> Submit </div>
          </form>
   </div>
  
</body>
  
  
<script>  
  
   $(document).ready(()=>{
     
     var url = window.location.href;     
    
     var catgories = ["Food", "Activities", "Transportation", "Misc."];
     // list of users
      // creates a  random user 
     var users = ["Alice","Bob", "Eve", "Jack", "Jill", "Carl", "Josh"];
     var user = users[Math.trunc(Math.random()*users.length)];
                                 
     var url_large = "http://sharedfinances-hchotwani921366.codeanyapp.com/draw/?size=large";
     var socket = new WebSocket('wss://sharedFinances-hchotwani921366.codeanyapp.com/ws/draw');
     
     document.getElementById("submit").onclick = function() {sendInfo()};

    function sendInfo() {
      //amount
      var amt = document.getElementById("amount").value;
      
      //category
      var e = document.getElementById("category");
      var value = e.options[e.selectedIndex].value;
      var text = e.options[e.selectedIndex].text;
      
      console.log(value);
      console.log(amt);
      
      //send Info
      var info = {"user": user, "amount": amt, "category":value};
      var infoJSON = JSON.stringify(info);
      socket.send(infoJSON);
      
      //confirmation of action                 
      alert("you have submitted your purchase!");                 
    };
     
     
     socket.onmessage = function(message) {
       info = JSON.parse(message.data);
       if (url===url_large) {
         $("#log").append("<div class='row log-box'><div class='col-12'>" + info.user + " spent $" + info.amount + " on "+ info.category + "</div></div>");
         console.log(info.amount);
         console.log(info.category);
         if (info.category === 'Food'){
           
         }
       } else {
         console.log("did not do anything with the message!!");
       }
     }
     
     // code for large screen
     if (url === url_large) {
         $("#submitForm").hide(0.000001);
         $(".finalize-btn").hide(0.000001);
         $('input').hide(); 
         var total_budget;
         var info;
          
         $(".plan").on('click', () => {
           //
           $('input').toggle();
           // show finalize button 
           $('.finalize-btn').toggle();
         });
       
          
           // finalize button functionality
           $('.finalize-btn').on('click', () =>{
             var food_amt = $('#food-amount').val();
             console.log(food_amt);
             var act_amt = $('#act-amount').val();
             var tra_amt = $('#tra-amount').val();
             var misc_amt = $('#misc-amount').val();
             total_budget = food_amt + act_amt + tra_amt + misc_amt;
             console.log("recognized click");
             $('input').hide();
             $('.finalize-btn').hide();
             $('.food-div').append(food_amt);
             $('.act-div').append(act_amt);
             $('.tra-div').append(tra_amt);
             $('.misc-div').append(misc_amt);
           })
       
          
     }
     
     // code for small screens
     if (url !== url_large) {
         $("#userBtn").hide(0.000001);
         $("#sharedBtn").hide(0.000001);
         $('.input-for-amounts').hide(); 
       
        
         $(".title").css("font-size","90px");
       
              
     }
     
     
//       var instmodal = document.getElementById("myInstModal");
//       var instbtn = document.getElementById("inst");
//       var span1 = document.getElementById("close1");
     
//       span1.onclick = function() {
//       instmodal.style.display = "none";
//       resume_clock();
//     }
     
//       instbtn.onclick = function() {
//       instmodal.style.display = "block";
//       console.log("yes");
//     }
      
//       window.onclick = function(event) {
//         if (event.target === instmodal) {
//           instmodal.style.display = "none";

//         }
//       }
  
  
   })
  
</script>
</html>